name: Move Code to Auctane Directory

on:
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout the code
    - name: Checkout code
      uses: actions/checkout@v3

    # Step 2: Set up Docker
    - name: Generate CodeSniffer Report
      uses: addnab/docker-run-action@v3
      with:
        image: markoshust/magento-php:8.3-fpm-2
        options: -v ${{ github.workspace }}:/var/www/html/src/app/code/Auctane
        run: |
          composer require --dev magento/magento-coding-standard
          composer config --no-plugins allow-plugins.dealerdirect/phpcodesniffer-composer-installer true
          composer install
          vendor/bin/phpcs --standard=Magento2 --report=checkstyle --report-file=/var/www/html/src/app/code/Auctane/report.xml --runtime-set ignore_warnings_on_exit 1 /var/www/html/src/app/code/Auctane
    
    # Step 3: Publish Test Report
    - name: Publish Test Report
        uses: mikepenz/action-junit-report@v4
        if: success() || failure() # always run even if the previous step fails
        with:
          report_paths: 'report.xml'